#!/bin/sh

usr() {
    echo "Rebuilding user configuration..."
    home-manager switch --flake ".#$user"
}

sys() {
    [ -z "$host" ] && echo "This set up doesnt suport a system build" && exit 1

    sudo -n echo "" >/dev/null || echo "You need to be root to rebuild the system configuration."
    echo "Rebuilding system configuration..."
    nixos-rebuild switch
}

case $1 in 
    "desktop") user="focus" && host="steambox"
    ;;
    "laptop") user="focus" && host="hazed"
    ;;
    "asahi") user="evan"
    ;;
    *) echo "Enter a host to rebuild: desktop, laptop, or asahi" && exit 1
    ;;
esac

case $2 in
    "usr") usr 
    ;;
    "sys") sys
    ;;
    "all") sys && usr
    ;;
    *) echo "Enter a target to rebuild: usr or sys" && exit 1
    ;;
esac

