#!/bin/sh

usr() {
    echo "Rebuilding user configuration..."
    if [ $(uname -r) != "*NixOs*" ]; then
        echo "You are not on NixOs, aliasing home-manager to use flakes"
        alias home-manager="home-manager --extra-experimental-features nix-command"
    fi
    home-manager switch --flake '.#focus'
}

sys() {
    echo "Rebuilding system configuration..."
    echo "As this is multi-user, you will be prompted for a password."
    sudo nixos-rebuild switch --flake '.#steambox'
}

case $1 in
    "usr") usr 
    ;;
    "sys") sys
    ;;
    "all") usr && sys
    ;;
    *) echo "Enter a target to rebuild: usr or sys" && exit 1
    ;;
esac

